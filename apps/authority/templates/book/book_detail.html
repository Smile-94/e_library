{% extends 'authority_base.html' %}
{% load static %}
{% load rbac_tags %}

{% block title %}
  {{ title }}
{% endblock %}

{% block body %}
<div class="bg-light rounded h-100 p-4">
  <h5 class="mb-4">Book Details</h5>

  <div class="row">
    <!-- Book Cover -->
    <div class="col-md-3 text-center">
      {% if book.book_image %}
        <img src="{{ book.book_image.url }}" class="img-fluid rounded mb-3" alt="Book Cover">
      {% else %}
        <img src="{% static 'img/no-book.png' %}" class="img-fluid rounded mb-3" alt="No Cover">
      {% endif %}
    </div>

    <!-- Book Info -->
    <div class="col-md-9">
      <table class="table table-bordered">
        <tr>
          <th width="30%">Title</th>
          <td>{{ book.title }}</td>
        </tr>
        <tr>
          <th>Author</th>
          <td>{{ book.author.get_full_name }}</td>
        </tr>
        <tr>
          <th>Category</th>
          <td>{{ book.category.category_name|default:"—" }}</td>
        </tr>
        <tr>
          <th>ISBN</th>
          <td>{{ book.isbn|default:"—" }}</td>
        </tr>
        <tr>
          <th>Language</th>
          <td>{{ book.language }}</td>
        </tr>
        <tr>
          <th>Publication Date</th>
          <td>{{ book.publication_date|date:"d M Y"|default:"—" }}</td>
        </tr>
        <tr>
          <th>Edition</th>
          <td>{{ book.edition|default:"—" }}</td>
        </tr>
        <tr>
          <th>Status</th>
          <td>
            <span class="badge bg-info">{{ book.get_status_display }}</span>
          </td>
        </tr>
        <tr>
          <th>Active Status</th>
          <td>
            {% if book.active_status == "active" %}
              <span class="badge bg-success">Active</span>
            {% else %}
              <span class="badge bg-danger">Inactive</span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <th>Digital Price</th>
          <td>{{ book.digital_price }}</td>
        </tr>
        <tr>
          <th>Physical Price</th>
          <td>{{ book.physical_price }}</td>
        </tr>
        <tr>
          <th>Purchase Price</th>
          <td>{{ book.purchase_price }}</td>
        </tr>
        <tr>
          <th>Discount</th>
          <td>{{ book.get_book_discount }}</td>
        </tr>
        <tr>
          <th>Discounted Price</th>
          <td>{{ book.get_discounted_price }}</td>
        </tr>
        <tr>
          <th>Has Physical Copy</th>
          <td>
            {% if book.has_physical_copy %}
              <span class="badge bg-success">Yes</span>
            {% else %}
              <span class="badge bg-secondary">No</span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <th>Read Only</th>
          <td>
            {% if book.is_read_only %}
              <span class="badge bg-warning">Yes</span>
            {% else %}
              <span class="badge bg-success">No</span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <th>Downloadable</th>
          <td>
            {% if book.is_downloadable %}
              <span class="badge bg-success">Yes</span>
            {% else %}
              <span class="badge bg-secondary">No</span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <th>Digital File</th>
          <td>
            {% if book.digital_file %}
              <a href="{{ book.digital_file.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                View File
              </a>
            {% else %}
              —
            {% endif %}
          </td>
        </tr>
        <tr>
          <th>Preview File</th>
          <td>
            {% if book.preview_file %}
              <a href="{{ book.preview_file.url }}" target="_blank" class="btn btn-sm btn-outline-info">
                Preview
              </a>
            {% else %}
              —
            {% endif %}
          </td>
        </tr>
        <tr>
          <th>Description</th>
          <td>{{ book.description|default:"—" }}</td>
        </tr>
        <tr>
          <th>Created By</th>
          <td>{{ book.created_by.get_fullname|default:"—" }}</td>
        </tr>
        <tr>
          <th>Created At</th>
          <td>{{ book.created_at|date:"d M Y, h:i A" }}</td>
        </tr>
        <tr>
          <th>Updated At</th>
          <td>{{ book.updated_at|date:"d M Y, h:i A" }}</td>
        </tr>
      </table>
    </div>
  </div>

  <!-- Actions -->
  <div class="mt-3">
    <a href="{% url 'authority:book_list' %}" class="btn btn-secondary">
      <i class="fa-solid fa-arrow-left"></i> Back
    </a>

    {% if request.user|has_permission:'can_edit_book' %}
      <a href="{% url 'authority:book_edit' book.id %}" class="btn btn-primary">
        <i class="fa-solid fa-pen-to-square"></i> Edit
      </a>
    {% endif %}
  </div>
</div>
{% endblock %}
