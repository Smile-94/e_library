{% extends 'authority_base.html' %}
{% load static %}
{% load widget_tweaks %}
{% load rbac_tags %}

{% block title %}
  {{ title }}
{% endblock %}

{% block body %}
<div class="bg-light rounded h-100 p-4">
  <h6 class="mb-4">{{ table_title }}</h6>

  <div class="row mb-4 align-items-center">
    <!-- Search -->
    <div class="col-md-6">
      {% if books %}
        <form class="d-flex" method="get">
          <div class="input-group">
            {{ books.form.search|add_class:'form-control' }}
            <button class="btn btn-outline-success" type="submit">Search</button>
          </div>
        </form>
      {% endif %}
    </div>

    <!-- Add Book -->
    <div class="col-md-6 text-end">
      {% if request.user|has_permission:'can_add_book' %}
        <a href="{% url 'authority:book_create' %}" class="btn btn-success">
          <i class="fa-solid fa-book-medical"></i> Add Book
        </a>
      {% endif %}
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="bg-dark text-white">
        <tr>
          <th>Sl</th>
          <th>Book Name</th>
          <th>Author</th>
          <th>Book Category</th>
          <th>ISBN</th>
          <th>Language</th>
          <th>Edition</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        {% if books %}
          {% for book in books.qs %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ book.title|capfirst }}</td>
            <td>{{ book.author.get_full_name|capfirst }}</td>
            <td>{{ book.category.category_name|capfirst }}</td>
            <td>{{ book.isbn }}</td>
            <td>{{ book.language|capfirst }}</td>
            <td>{{ book.edition|capfirst }}</td>

            <!-- âœ… FIXED STATUS COLUMN -->
            <td>
              {% if book.active_status == "active" %}
                <span class="badge bg-success">Active</span>
              {% else %}
                <span class="badge bg-danger">Inactive</span>
              {% endif %}
            </td>

            <!-- Actions -->
            <td class="text-nowrap">
              {% comment %} <a class="btn btn-success btn-sm" href="{% url 'authority:book_detail' book.id %}"> {% endcomment %}
              <a class="btn btn-success btn-sm" href="{% url 'authority:book_detail' book.id %}">
                <i class="fa-solid fa-eye"></i>
              </a>

              {% if request.user|has_permission:'can_edit_book' %}
                <a class="btn btn-primary btn-sm" href="{% url 'authority:book_edit' book.id %}">
                  <i class="fa-regular fa-pen-to-square"></i>
                </a>
              {% endif %}

              {% if request.user|has_permission:'can_delete_book' %}
                {% comment %} <a class="btn btn-danger btn-sm" href="{% url 'authority:book_delete' book.id %}">
                  <i class="fa-solid fa-trash"></i>
                </a> {% endcomment %}
                {% comment %} <a class="btn btn-danger btn-sm" href="#">
                  <i class="fa-solid fa-trash"></i>
                </a> {% endcomment %}
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="9" class="text-center">No books found!</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
